{"version":3,"kind":"Notebook","sha256":"46e6deec5fd9e590238572451f9d183e62376bcbe08b0513c7b79acfcf226ed6","slug":"obspy","location":"/obspy.ipynb","dependencies":[],"frontmatter":{"title":"Obspyとの連携","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"github":"https://github.com/tktmyd/pygmt-howto-jp","copyright":"2021-2025. All Rights Reserved","settings":{"output_stderr":"remove-warn"},"numbering":{"title":{"offset":1}},"source_url":"https://github.com/tktmyd/pygmt-howto-jp/blob/main/src/obspy.ipynb","edit_url":"https://github.com/tktmyd/pygmt-howto-jp/edit/main/src/obspy.ipynb","exports":[{"format":"ipynb","filename":"obspy.ipynb","url":"/pygmt-howto-jp/build/obspy-fbd446c1145667ef90b36fa62a7a8475.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"ObsPyは地震学で広く使われているパッケージです．様々な機能がありますが，広範な種類の波形フォーマットに対応しているため，自作のプログラムでも波形の読み書き部分だけはObsPyで，といった使い方ができます．ここではこの機能を使って地震波形ファイルを読み込み，それをPyGMTで描画してみます．","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rERvPUdd4J"}],"key":"mX3pIuszST"}],"visibility":"show","key":"kVipfQHtto"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import pygmt\nimport obspy\nfrom obspy import UTCDateTime","visibility":"show","key":"efGvuSMZtc"},{"type":"outputs","id":"imymEub3QwuLpzrtIjAJU","children":[],"visibility":"show","key":"eWOmXYKrgR"}],"visibility":"show","key":"AYXObQG3TO"},{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"SAC (Seismic Analysis Code) に含まれている地震波形例をファイルとして保存し，それをObsPyから読み込んでみ ましょう．SACでは以下のようなコマンドを実行することでサンプルファイルを作ります．","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"mwUVudgfay"}],"key":"GiAJvAu2GH"},{"type":"code","lang":"bash","value":"$ sac\n SEISMIC ANALYSIS CODE [10/13/2020 (Version 101.6a)]\n Copyright 1995 Regents of the University of California\n\nSAC> funcgen seismogram\nSAC> w dat/example.sac\nSAC> quit","position":{"start":{"line":4,"column":1},"end":{"line":12,"column":1}},"key":"WoS0MVoHgv"}],"visibility":"show","key":"VCUWeHhyCP"},{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"ObsPy で読み込むには ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Y8gI7fF5P5"},{"type":"inlineCode","value":"obspy.core.read","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nRNerImlIZ"},{"type":"text","value":" を使います．このコマンドは任意個数の地震波形を stream 形式という専用の型のリストに読み込みます．今回読み込むのは1波形だけなので，その最初の成分を ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eQrELIrPk1"},{"type":"inlineCode","value":"trace0","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MpagpB9t57"},{"type":"text","value":" として抽出しましょう．","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lADhugn73W"}],"key":"HOcTdzy1tN"}],"visibility":"show","key":"rQNSrCRacY"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"trace = obspy.core.read('./dat/example.sac')\ntrace0 = trace[0]","visibility":"show","key":"TQZ4jjJNI2"},{"type":"outputs","id":"DZWgLV6mnJ1_TMKFrTVUG","children":[],"visibility":"show","key":"i3oyL8qyWT"}],"visibility":"show","key":"Y3CEe59W3d"},{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"ObsPyは内部でmatplotlibと連携していて，波形に付随するメソッドの ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i3Kq6GWxFe"},{"type":"inlineCode","value":"plot","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GDmCs8v3fm"},{"type":"text","value":" を使うだけで，波形を適当にプロットしてくれます．","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cqAHc6ImGS"}],"key":"ukKBvZUShG"}],"visibility":"show","key":"QIXnFzAHM4"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"p = trace0.plot()","visibility":"show","key":"h3nB6yY4nS"},{"type":"outputs","id":"5e_Xk6-mN5IwHSQlOI22y","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f1aee9c7d74b93dcf701a10baa265fbf","path":"/f1aee9c7d74b93dcf701a10baa265fbf.png"},"text/plain":{"content":"<Figure size 800x250 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"GCvePOlEFR"}],"visibility":"show","key":"MEdyb83DRl"}],"visibility":"show","key":"kwUWOxIXGs"},{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"ObsPyで読み込んだ波形には，","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EWeHaLPk5A"}],"key":"Yd0ap5mMUv"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"波形振幅データ ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lqLszizQ5u"},{"type":"inlineCode","value":"trace0.data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uFbzGABy5x"}],"key":"xIR6KSYi3k"}],"key":"sOt5bnMLVk"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"波形時刻情報 ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"bjnlLCRl2l"},{"type":"inlineCode","value":"trace0.times()","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"CcTUSlgpDF"}],"key":"cXIK5CeAaI"}],"key":"QUqe97wyB5"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"その他ヘッダ情報 ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"KQ4In7ierd"},{"type":"inlineCode","value":"trace0.stats","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"hEdd7auA3G"}],"key":"GXoukwFabX"}],"key":"HbuzXS8Hkk"}],"key":"f3wTPSWEVy"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"といった情報が含まれます．ObsPyは様々な波形データ形式に対応するなかで，今回はSAC形式の波形を読み込んでいるので，","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"WBJRyxqZt7"},{"type":"inlineCode","value":"trace0.stats.sac","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"navzRj9gEg"},{"type":"text","value":"という辞書に，SAC形式のヘッダが格納されています．","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"KNjqHULx45"}],"key":"qtzBkq52O1"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"では，これを PyGMT で同じようにプロットしてみましょう．","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Sw9KnuxQ1e"}],"key":"I8cqUWDAgA"}],"visibility":"show","key":"HqWSvt9gwI"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = pygmt.Figure()\n\nfig.plot(\n    projection = 'X20c/5c',\n    region = [trace0.stats.starttime, trace0.stats.endtime, -2, 2],\n    x = trace0.times(\"timestamp\"), \n    y = trace0.data,\n    pen = 'thick,50/50/150'\n)\n\nfig.text(\n    text = \"Station \" + trace0.stats.station, \n    position = 'RT', \n    offset = 'j0.5c/0.5c',\n    font = '12p,Helvetica-Bold,Black'\n)\n\nfig.basemap(\n    frame  = ['WSen', 'xaf+ltime', 'yaf+lampltude' ],\n)\n\nfig.show()","visibility":"show","key":"vYARV0adxl"},{"type":"outputs","id":"cnj1rXNEsq13mnNKSFwrY","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{"image/png":{"width":500}},"data":{"image/png":{"content_type":"image/png","hash":"f7b89692b1fb1cf96b00ec642204b0ca","path":"/f7b89692b1fb1cf96b00ec642204b0ca.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"mT4KAEKZkB"}],"visibility":"show","key":"KMFxlKaZoD"}],"visibility":"show","key":"YCdYEx5D1H"},{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"基本的にこれまでに出てきたコマンドの組み合わせで実現できます．","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hUMyKT8JV8"}],"key":"uy4iVPaBUT"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"特記すべきは","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xbmyiOHHtH"},{"type":"inlineCode","value":"region","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CcfWUGlMW3"},{"type":"text","value":" の横軸で，ObsPyのヘッダ（","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rWe4lVzm24"},{"type":"inlineCode","value":"stats","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xwAycoD9Co"},{"type":"text","value":"）に含まれる開始時間 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BWhodYIT3M"},{"type":"inlineCode","value":"starttime","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JEM1WAgrQI"},{"type":"text","value":" と 終了時間 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wQ1EPWChYs"},{"type":"inlineCode","value":"endtime","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JAfC8FdIit"},{"type":"text","value":" がそのまま ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NdJgtNqHDh"},{"type":"inlineCode","value":"pygmt","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HYQuIonjLP"},{"type":"text","value":" の範囲指定に使えるのです．また，","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sS9sBuEWgF"},{"type":"inlineCode","value":"fig.plot","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yVzHnKjv5A"},{"type":"text","value":" に与える x軸データも，ObsPyの波形の時間情報 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jMuHM9ZO5o"},{"type":"inlineCode","value":"trace0.times()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iU17Ryy9XE"},{"type":"text","value":" をそのまま与えることができます．","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QhNf81C1of"}],"key":"yto15qsTcL"}],"visibility":"show","key":"Auf7rlwu7A"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = pygmt.Figure()\n\nfig.plot(\n    projection = 'X20c/5c',\n    region = [0, trace0.stats.delta * trace0.stats.npts, -2, 2],\n    x = trace0.times(), \n    y = trace0.data,\n    pen = 'thick,50/50/150'\n)\n\nfig.text(\n    text = \"Station \" + trace0.stats.station, \n    position = 'RT', \n    offset = 'j0.5c/0.5c',\n    font = '12p,Helvetica-Bold,Black'\n)\n\nfig.basemap(\n    frame  = ['WSen', 'xaf+ltime [s]', 'yaf+lampltude' ],\n)\n\nfig.show()","visibility":"show","key":"qgbITNtZIo"},{"type":"outputs","id":"NwwRzUasokzgDzFQqTrA4","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{"image/png":{"width":500}},"data":{"image/png":{"content_type":"image/png","hash":"cc545b49c1d06513fe62e7f129e45cc6","path":"/cc545b49c1d06513fe62e7f129e45cc6.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"x5nXt06ERL"}],"visibility":"show","key":"zEtoOk7tOB"}],"visibility":"show","key":"oSIB0V6Ojd"}],"key":"SWFoKYG06B"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"GMTの微調整","url":"/config","group":"応用編"},"next":{"title":"震源メカニズム解の表現","url":"/mech","group":"応用編"}}},"domain":"http://localhost:3001"}